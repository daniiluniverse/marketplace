<!DOCTYPE html>
<html>
<head>
    <title>Product Manager</title>
    <style>
        body { font-family: Arial; max-width: 600px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input { width: 100%; padding: 8px; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 15px; cursor: pointer; }
        #result { margin-top: 20px; padding: 10px; border-radius: 4px; }
        .success { background: #dff0d8; }
        .error { background: #f2dede; }
    </style>
</head>
<body>
<h1>Create Product</h1>

<div class="form-group">
    <label>Product Name:</label>
    <input type="text" id="name" value="Asus">
</div>

<div class="form-group">
    <label>Details:</label>
    <input type="text" id="details" value="NoteBook Asus">
</div>

<div class="form-group">
    <label>Price:</label>
    <input type="number" id="price" value="65000">
</div>

<button onclick="createProduct()">Create Product</button>

<div id="result"></div>

<script>
    async function createProduct() {
        const resultDiv = document.getElementById('result');
        resultDiv.className = '';
        resultDiv.textContent = 'Processing...';

        try {
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name: document.getElementById('name').value,
                    details: document.getElementById('details').value,
                    price: parseFloat(document.getElementById('price').value)
                }),
                credentials: 'include' // Важно для передачи куки
            });

            const data = await response.json();
            resultDiv.className = response.ok ? 'success' : 'error';
            resultDiv.textContent = JSON.stringify(data, null, 2);
        } catch (error) {
            resultDiv.className = 'error';
            resultDiv.textContent = 'Error: ' + error.message;

            // Если 401 - перенаправляем на логин
            if (error.response?.status === 401) {
                window.location.href = 'http://localhost:8082/realms/market/protocol/openid-connect/auth?client_id=manager-app&redirect_uri=http://localhost:8083/&response_type=code';
            }
        }
    }
</script>
</body>
</html>